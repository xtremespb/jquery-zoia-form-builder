/*! zoiaFormBuilder v1.0.0 | (c) Michael A. Matveev | github.com/xtremespb/zoiaFormBuilder 
*/ 
;'use strict';var _typeof='function'==typeof Symbol&&'symbol'==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&'function'==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?'symbol':typeof a};(function(a){'use strict';var b='zoiaFormBuilder',c={load:{url:'#',method:'POST'},save:{url:'#',method:'POST'},captcha:'/api/captcha',items:[],edit:!1,validation:!0,html:{helpText:'<div class="za-text-meta">{text}</div>',text:'<div class="za-margin-bottom"><label class="za-form-label" for="{prefix}_{name}">{label}:</label><br><div class="za-form-controls"><input class="za-input {prefix}-form-field{css}" id="{prefix}_{name}" type="{type}" placeholder=""{autofocus}><div id="{prefix}_{name}_error_text" class="{prefix}-error-text" style="display:none"><span class="za-label-danger"></span></div>{helpText}</div></div>',select:'<div class="za-margin-bottom"><label class="za-form-label" for="{prefix}_{name}">{label}:</label><br><select class="za-select {prefix}-form-field{css}" id="{prefix}_{name}"{autofocus}>{values}</select><div id="{prefix}_{name}_error_text" class="{prefix}-error-text" style="display:none"><span class="za-label-danger"></span></div>{helpText}</div>',passwordConfirm:'<div class="za-margin"><label class="za-form-label" for="{prefix}_{name}">{label}:</label><div class="za-flex"><div class="{prefix}-field-wrap"><input class="za-input {prefix}-form-field" id="{prefix}_{name}" type="password" placeholder=""{autofocus}></div><div><input class="za-input {prefix}-form-field" id="{prefix}_{name}Confirm" type="password" placeholder=""></div></div><div id="{prefix}_{name}_error_text" class="{prefix}-error-text" style="display:none"><span class="za-label-danger"></span></div>{helpText}</div>',captcha:'<div class="za-margin"><label class="za-form-label" for="{prefix}_{name}">{label}:</label><div class="za-grid za-grid-small"><div><input class="za-input {prefix}-form-field {prefix}-captcha-field{css}" type="text" placeholder="" id="{prefix}_{name}"{autofocus}></div><div><div class="za-form-controls"><img class="{prefix}-captcha-img"></div></div></div><div id="{prefix}_{name}_error_text" class="{prefix}-error-text" style="display:none"><span class="za-label-danger"></span></div>{helpText}',buttonsWrap:'<div class="{css}">{buttons}{html}</div>',button:'<button class="za-button {prefix}-form-button{css}" id="{prefix}_{name}" type="{type}">{label}</button>',launcher:'<div class="za-margin"><label class="za-form-label" for="{prefix}_{name}_btn">{label}:</label><div class="za-flex"><div id="{prefix}_{name}_val" class="{prefix}-{name}-selector" data="{data}">{value}</div><div><button class="za-button za-button-default" id="{prefix}_{name}_btn" type="button">{labelBtn}</button></div></div>{helpText}</div>',textarea:'<div class="za-margin-bottom"><label class="za-form-label" for="{prefix}_{name}">{label}:</label><br><div class="za-form-controls"><textarea class="za-textarea {prefix}-form-field{css}" id="{prefix}_{name}"{autofocus}></textarea><div id="{prefix}_{name}_error_text" class="{prefix}-error-text" style="display:none"><span class="za-label-danger"></span></div>{helpText}</div></div>'},template:{fields:'{fields}',buttons:'{buttons}'},lang:{mandatoryMissing:'Should not be empty',tooShort:'Too short',tooLong:'Too long',invalidFormat:'Doesn\'t match required format',passwordsNotMatch:'Passwords do not match'},events:{onInit:function onInit(){},onSaveSubmit:function onSaveSubmit(){},onSaveValidate:function onSaveValidate(){},onSaveSuccess:function onSaveSuccess(){},onSaveError:function onSaveError(){},onLoadStart:function onLoadStart(){},onLoadSuccess:function onLoadSuccess(){},onLoadError:function onLoadError(){}},formDangerClass:'za-form-danger'},f=function(g,h){this.element=g,this.settings=a.extend({},c,h),this._defaults=c,this._name=b,this._prefix=this.element.id,this._formTypes=['text','email','password','select','passwordConfirm','captcha','launcher','textarea'],this._saving=!1,this.init()};a.extend(f.prototype,{init:function init(){var g='',h='';for(var j in this.settings.items){var l=this.settings.items[j];switch(l.type){case'text':case'email':case'password':g+=this._template(this.settings.html.text,{prefix:this._prefix,name:j,label:l.label,css:l.css?' '+l.css:'',autofocus:l.autofocus?'autofocus':'',helpText:l.helpText?this._template(this.settings.html.helpText,{text:l.helpText,prefix:this._prefix}):'',type:l.type});break;case'launcher':g+=this._template(this.settings.html.launcher,{prefix:this._prefix,name:j,label:l.label,labelBtn:l.labelBtn,data:l.data,value:l.value,css:l.css?' '+l.css:'',helpText:l.helpText?this._template(this.settings.html.helpText,{text:l.helpText,prefix:this._prefix}):''});break;case'select':var o='';for(var q in l.values)o+='<option value="'+q+'">'+l.values[q]+'</option>';g+=this._template(this.settings.html.select,{prefix:this._prefix,name:j,label:l.label,css:l.css?' '+l.css:'',autofocus:l.autofocus?'autofocus':'',helpText:l.helpText?this._template(this.settings.html.helpText,{text:l.helpText,prefix:this._prefix}):'',type:l.type,values:o});break;case'passwordConfirm':g+=this._template(this.settings.html.passwordConfirm,{prefix:this._prefix,name:j,label:l.label,css:l.css?' '+l.css:'',autofocus:l.autofocus?'autofocus':'',helpText:l.helpText?this._template(this.settings.html.helpText,{text:l.helpText,prefix:this._prefix}):'',type:'password'});break;case'captcha':g+=this._template(this.settings.html.captcha,{prefix:this._prefix,name:j,css:l.css?' '+l.css:'',label:l.label,helpText:l.helpText?this._template(this.settings.html.helpText,{text:l.helpText,prefix:this._prefix}):'',autofocus:l.autofocus?'autofocus':''});break;case'textarea':g+=this._template(this.settings.html.textarea,{prefix:this._prefix,name:j,label:l.label,css:l.css?' '+l.css:'',autofocus:l.autofocus?'autofocus':'',helpText:l.helpText?this._template(this.settings.html.helpText,{text:l.helpText,prefix:this._prefix}):''});break;case'buttons':for(var u,r='',t=0;t<l.buttons.length;t++)u=l.buttons[t],r+=this._template(this.settings.html.button,{css:u.css?' '+u.css:'',prefix:this._prefix,name:u.name||'button'+t,type:u.type||'button',label:u.label||''})+'&nbsp;';h+=this._template(this.settings.html.buttonsWrap,{prefix:this._prefix,css:l.css?' '+l.css:'',buttons:r,html:l.html?' '+l.html:''});}}a(this.element).html(this._template(this.settings.template.fields,{fields:g})+this._template(this.settings.template.buttons,{buttons:h})),this.settings.events.onInit&&this.settings.events.onInit();var w=this;a(this.element).submit(function(x){x.preventDefault(),w._submit()}),this._captchaInit()},setValidation:function setValidation(g){this.validation=g},setEditMode:function setEditMode(g){this.settings.edit=g},clearErrors:function clearErrors(){a('.'+this._prefix+'-form-field').removeClass(this.settings.formDangerClass),a('.'+this._prefix+'-error-text').hide()},resetForm:function resetForm(){this.clearErrors();this;for(var h in a('.'+this._prefix+'-form-field').not('.zoiaFormBuilder-no-reset').val(''),a('select.'+this._prefix+'-form-field').prop('selectedIndex',0),this.settings.items){var j=this.settings.items[h];j.default&&a('#'+this._prefix+'_'+h).val(j.default),'launcher'===j.type&&(a('#'+this._prefix+'_'+h+'_val').html(j.value),a('#'+this._prefix+'_'+h+'_val').attr('data',j.data))}},serialize:function serialize(){var g={};for(var h in this.settings.items){var j=this.settings.items[h];if(-1!==this._formTypes.indexOf(j.type))switch(j.type){case'launcher':g[h]={type:j.type,value:a('#'+this._prefix+'_'+h+'_val').html(),id:a('#'+this._prefix+'_'+h+'_val').attr('data')};break;default:g[h]={type:j.type,value:a('#'+this._prefix+'_'+h).val()};}}return g},deserialize:function deserialize(g){if(g&&'object'===('undefined'==typeof g?'undefined':_typeof(g)))for(var h in this.settings.items)switch(g[h]||(g[h]={id:'',value:''}),g[h].type){case'launcher':a('#'+this._prefix+'_'+h+'_val').html(g[h].value),a('#'+this._prefix+'_'+h+'_val').attr('data',g[h].id);break;default:a('#'+this._prefix+'_'+h).val(g[h].value||'');}},loadData:function loadData(g){this.settings.events.onLoadStart&&this.settings.events.onLoadStart(),this.resetForm();var h=this;a.ajax({type:this.settings.load.method,url:this.settings.load.url,data:g,cache:!1}).done(function(j){j&&1===j.status?(jQuery.each(j.item,function(l,o){a('#'+h._prefix+'_'+l).val(o)}),h.settings.events.onLoadSuccess&&h.settings.events.onLoadSuccess(j)):h.settings.events.onLoadError&&h.settings.events.onLoadError(j)}).fail(function(j,l){h.settings.events.onLoadError&&h.settings.events.onLoadError(j,l)})},captchaRefresh:function captchaRefresh(){a('.'+this._prefix+'-captcha-img').show(),a('.'+this._prefix+'-captcha-img').attr('src',this.settings.captcha+'?'+new Date().getTime()),a('.'+this._prefix+'-captcha-field').val('')},_captchaInit:function _captchaInit(){this.captchaRefresh();var g=this;a('img.'+this._prefix+'-captcha-img').click(function(){g.captchaRefresh()})},_template:function _template(g,h){for(var j in h)g=g.replace(new RegExp('{'+j+'}','g'),h[j]);return g},validate:function validate(g){var h={},j={};for(var l in this.settings.items){var o=this.settings.items[l];if(-1!==this._formTypes.indexOf(o.type)){if('launcher'===o.type){j[l]=g?g[l]?g[l].id:void 0:a('#'+this._prefix+'_'+l+'_val').attr('data');continue}var q=g?g[l]?g[l].value:void 0:a('#'+this._prefix+'_'+l).val();if(o.validation){if(!o.validation.mandatoryEdit&&!q&&this.settings.edit||!o.validation.mandatoryCreate&&!q&&!this.settings.edit)continue;if(o.validation.mandatoryCreate&&!q&&!this.settings.edit){h[l]=this.settings.lang.mandatoryMissing;continue}if(o.validation.mandatoryEdit&&!q&&this.settings.edit){h[l]=this.settings.lang.mandatoryMissing;continue}if(o.validation.process&&'function'==typeof o.validation.process&&(q=o.validation.process(q)),'passwordConfirm'===o.type){var r=a('#'+this._prefix+'_'+l+'Confirm').val();if(r!==q){h[l]=this.settings.lang.passwordsNotMatch;continue}}if(o.validation.length){if(o.validation.length.min&&q.length<o.validation.length.min){h[l]=this.settings.lang.tooShort;continue}if(o.validation.length.max&&q.length>o.validation.length.max){h[l]=this.settings.lang.tooLong;continue}}if(o.validation.regexp&&!q.match(o.validation.regexp)){h[l]=this.settings.lang.invalidFormat;continue}j[l]=q}}}return{data:j,errors:h}},errors:function errors(g){if(0<Object.keys(g).length){var h=!1;for(var j in g)a('#'+this._prefix+'_'+j).addClass(this.settings.formDangerClass),a('#'+this._prefix+'_'+j+'_error_text > span').html(g[j]),a('#'+this._prefix+'_'+j+'_error_text').show(),h||(a('#'+this._prefix+'_'+j).focus(),h=!0),'passwordConfirm'===this.settings.items[j].type&&a('#'+this._prefix+'_'+j+'Confirm').addClass(this.settings.formDangerClass);return!0}return!1},_submit:function _submit(){if(!this._saving){this.settings.events.onSaveSubmit&&this.settings.events.onSaveSubmit(),this.clearErrors();var g=this,h={},j={};if(this.settings.validation){var l=this.validate();if(h=l.data||{},j=l.errors||{},this.errors(j))return;if(this.settings.events.onSaveValidate&&(h=this.settings.events.onSaveValidate(h)||h,'__stop'===h))return}else if(this.settings.events.onSaveValidate&&(h=this.settings.events.onSaveValidate(h),'__stop'===h))return;g._saving=!0,a.ajax({type:this.settings.save.method,url:this.settings.save.url,data:h,cache:!1}).done(function(o){if(g._saving=!1,o&&1===o.status)g.settings.events.onSaveSuccess&&g.settings.events.onSaveSuccess(o);else{if(o.fields)for(var q in o.fields){var r=!1;a('#'+g._prefix+'_'+o.fields[q]).addClass(g.settings.formDangerClass),r||(a('#'+g._prefix+'_'+o.fields[q]).focus(),r=!0)}g.captchaRefresh(),g.settings.events.onSaveError&&g.settings.events.onSaveError(o)}}).fail(function(o,q){g._saving=!1,g.captchaRefresh(),g.settings.events.onSaveError&&g.settings.events.onSaveError(o,q)})}}}),a.fn[b]=function(g){var h;return this.each(function(){h=a.data(this,'plugin_'+b),h||(h=new f(this,g),a.data(this,'plugin_'+b,h))}),h}})(jQuery,window,document);