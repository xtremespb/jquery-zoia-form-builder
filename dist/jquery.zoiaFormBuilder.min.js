/*! zoiaFormBuilder v1.0.3 | (c) Michael A. Matveev | github.com/xtremespb/zoiaFormBuilder 
 */
;
'use strict';var _typeof='function'==typeof Symbol&&'symbol'==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&'function'==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?'symbol':typeof a};(function(a){'use strict';var b='zoiaFormBuilder',c={load:{url:'#',method:'POST'},save:{url:'#',method:'POST'},captcha:'/api/captcha',items:[],edit:!1,validation:!0,html:{helpText:'<div class="uk-text-meta">{text}</div>',text:'<div class="uk-margin-bottom"><label class="uk-form-label" for="{prefix}_{name}">{label}:</label><br><div class="uk-form-controls"><input class="uk-input {prefix}-form-field{css}" id="{prefix}_{name}" type="{type}" placeholder=""{autofocus}><div id="{prefix}_{name}_error_text" class="{prefix}-error-text" style="display:none"><span class="uk-label-danger"></span></div>{helpText}</div></div>',select:'<div class="uk-margin-bottom"><label class="uk-form-label" for="{prefix}_{name}">{label}:</label><br><select{multiple} class="uk-select {prefix}-form-field{css}" id="{prefix}_{name}"{autofocus}>{values}</select><div id="{prefix}_{name}_error_text" class="{prefix}-error-text" style="display:none"><span class="uk-label-danger"></span></div>{helpText}</div>',passwordConfirm:'<div class="uk-margin"><label class="uk-form-label" for="{prefix}_{name}">{label}:</label><div class="uk-flex"><div class="{prefix}-field-wrap"><input class="uk-input {prefix}-form-field" id="{prefix}_{name}" type="password" placeholder=""{autofocus}></div><div><input class="uk-input {prefix}-form-field" id="{prefix}_{name}Confirm" type="password" placeholder=""></div></div><div id="{prefix}_{name}_error_text" class="{prefix}-error-text" style="display:none"><span class="uk-label-danger"></span></div>{helpText}</div>',captcha:'<div class="uk-margin"><label class="uk-form-label" for="{prefix}_{name}">{label}:</label><div class="uk-grid uk-grid-small"><div><input class="uk-input {prefix}-form-field {prefix}-captcha-field{css}" type="text" placeholder="" id="{prefix}_{name}"{autofocus}></div><div><div class="uk-form-controls"><img class="{prefix}-captcha-img"></div></div></div><div id="{prefix}_{name}_error_text" class="{prefix}-error-text" style="display:none"><span class="uk-label-danger"></span></div>{helpText}',buttonsWrap:'<div class="{css}">{buttons}{html}</div>',button:'<button class="uk-button {prefix}-form-button{css}" id="{prefix}_{name}" type="{type}">{label}</button>',launcher:'<div class="uk-margin"><label class="uk-form-label" for="{prefix}_{name}_btn">{label}:</label><div class="uk-flex"><div id="{prefix}_{name}_val" class="{prefix}-{name}-selector" data="{data}">{value}</div><div><button class="uk-button uk-button-default" id="{prefix}_{name}_btn" type="button">{labelBtn}</button></div></div>{helpText}</div>',textarea:'<div class="uk-margin-bottom"><label class="uk-form-label" for="{prefix}_{name}">{label}:</label><br><div class="uk-form-controls"><textarea class="uk-textarea {prefix}-form-field{css}" id="{prefix}_{name}"{autofocus}></textarea><div id="{prefix}_{name}_error_text" class="{prefix}-error-text" style="display:none"><span class="uk-label-danger"></span></div>{helpText}</div></div>',checkboxlistItem:'<li><label><input class="uk-checkbox {prefix}-{name}-cbx" type="checkbox" data="{title}">&nbsp;&nbsp;{title}</label></li>',checkboxlist:'<div class="uk-margin-bottom"><label class="uk-form-label" for="{prefix}_{name}">{label}:</label><div class="uk-panel uk-panel-scrollable{css}" id="{prefix}_{name}_wrap"><ul class="uk-list">{items}</ul></div>{helpText}</div>',valueslistItem:'<div class="uk-flex uk-margin-top {prefix}-{name}-item"><div class="uk-margin-right"><input placeholder="{langParameter}" type="text" class="uk-input formBuilder-valueslist-par" value="{key}"></div><div class="uk-margin-right"><input placeholder="{langValue}" type="text" class="uk-input formBuilder-valueslist-val" value="{value}"></div><div style="padding-top:3px"><button class="uk-icon-button uk-button-danger formBuilder-valueslist-btnDel" uk-icon="icon:minus"></button></div></div>',valueslist:'<div class="uk-flex uk-flex-column"><div class="uk-margin-bottom"><label class="uk-form-label">{label}:</label></div><div><button type="button" class="uk-icon-button uk-button-primary formBuilder-valueslist-btnAdd" id="{prefix}_{name}_btnAdd" uk-icon="icon:plus" data-prefix="{prefix}" data-name="{name}"></button></div><div id="{prefix}_{name}_wrap" class="uk-margin-bottom formBuilder-valueslist-wrap">{items}</div></div>'},template:{fields:'{fields}',buttons:'{buttons}'},lang:{mandatoryMissing:'Should not be empty',tooShort:'Too short',tooLong:'Too long',invalidFormat:'Doesn\'t match required format',passwordsNotMatch:'Passwords do not match',parameter:'Parameter',value:'Value'},events:{onInit:function onInit(){},onSaveSubmit:function onSaveSubmit(){},onSaveValidate:function onSaveValidate(){},onSaveSuccess:function onSaveSuccess(){},onSaveError:function onSaveError(){},onLoadStart:function onLoadStart(){},onLoadSuccess:function onLoadSuccess(){},onLoadError:function onLoadError(){}},formDangerClass:'uk-form-danger'},f=function(g,h){this.element=g,this.settings=a.extend({},c,h),this._defaults=c,this._name=b,this._prefix=this.element.id,this._formTypes=['text','email','password','select','passwordConfirm','captcha','launcher','textarea','checkboxlist','valueslist'],this._saving=!1,this.init()};a.extend(f.prototype,{init:function init(){var g='',h='';for(var j in this.settings.items){var l=this.settings.items[j];switch(l.type){case'text':case'email':case'password':g+=this._template(this.settings.html.text,{prefix:this._prefix,name:j,label:l.label,css:l.css?' '+l.css:'',autofocus:l.autofocus?'autofocus':'',helpText:l.helpText?this._template(this.settings.html.helpText,{text:l.helpText,prefix:this._prefix}):'',type:l.type});break;case'launcher':g+=this._template(this.settings.html.launcher,{prefix:this._prefix,name:j,label:l.label,labelBtn:l.labelBtn,data:l.data,value:l.value,css:l.css?' '+l.css:'',helpText:l.helpText?this._template(this.settings.html.helpText,{text:l.helpText,prefix:this._prefix}):''});break;case'valueslist':var o='';for(var q in l.values)o+=this._template(this.settings.html.valueslistItem,{prefix:this._prefix,name:j,key:q,value:l.values[q],langParameter:this.settings.lang.parameter,langValue:this.settings.lang.value});g+=this._template(this.settings.html.valueslist,{prefix:this._prefix,name:j,label:l.label,items:o});break;case'select':var r='';for(var t in l.values)r+='<option value="'+t+'">'+l.values[t]+'</option>';g+=this._template(this.settings.html.select,{prefix:this._prefix,name:j,label:l.label,css:l.css?' '+l.css:'',multiple:l.multiple?' multiple':'',autofocus:l.autofocus?'autofocus':'',helpText:l.helpText?this._template(this.settings.html.helpText,{text:l.helpText,prefix:this._prefix}):'',type:l.type,values:r});break;case'checkboxlist':var u='';for(var w in l.values)u+=this._template(this.settings.html.checkboxlistItem,{prefix:this._prefix,name:j,title:l.values[w]});g+=this._template(this.settings.html.checkboxlist,{prefix:this._prefix,name:j,label:l.label,css:l.css?' '+l.css:'',multiple:l.multiple?' multiple':'',helpText:l.helpText?this._template(this.settings.html.helpText,{text:l.helpText,prefix:this._prefix}):'',items:u});break;case'passwordConfirm':g+=this._template(this.settings.html.passwordConfirm,{prefix:this._prefix,name:j,label:l.label,css:l.css?' '+l.css:'',autofocus:l.autofocus?'autofocus':'',helpText:l.helpText?this._template(this.settings.html.helpText,{text:l.helpText,prefix:this._prefix}):'',type:'password'});break;case'captcha':g+=this._template(this.settings.html.captcha,{prefix:this._prefix,name:j,css:l.css?' '+l.css:'',label:l.label,helpText:l.helpText?this._template(this.settings.html.helpText,{text:l.helpText,prefix:this._prefix}):'',autofocus:l.autofocus?'autofocus':''});break;case'textarea':g+=this._template(this.settings.html.textarea,{prefix:this._prefix,name:j,label:l.label,css:l.css?' '+l.css:'',autofocus:l.autofocus?'autofocus':'',helpText:l.helpText?this._template(this.settings.html.helpText,{text:l.helpText,prefix:this._prefix}):''});break;case'buttons':for(var z,x='',y=0;y<l.buttons.length;y++)z=l.buttons[y],x+=this._template(this.settings.html.button,{css:z.css?' '+z.css:'',prefix:this._prefix,name:z.name||'button'+y,type:z.type||'button',label:z.label||''})+'&nbsp;';h+=this._template(this.settings.html.buttonsWrap,{prefix:this._prefix,css:l.css?' '+l.css:'',buttons:x,html:l.html?' '+l.html:''});}}a(this.element).html(this._template(this.settings.template.fields,{fields:g})+this._template(this.settings.template.buttons,{buttons:h})),a('.formBuilder-valueslist-btnAdd').unbind(),a('.formBuilder-valueslist-btnAdd').click(function(){A._valueslistAddFunc(a(this).attr('data-prefix'),a(this).attr('data-name'),'','')}),a('.formBuilder-valueslist-btnDel').unbind(),a('.formBuilder-valueslist-btnDel').click(function(B){B.stopPropagation(),a(this).parent().parent().remove()}),this.settings.events.onInit&&this.settings.events.onInit();var A=this;a(this.element).submit(function(B){B.preventDefault(),A._submit()}),this._captchaInit()},_valueslistAddFunc:function _valueslistAddFunc(g,h,j,l,o){var q=this._template(this.settings.html.valueslistItem,{prefix:g,name:h,key:j,value:l,langParameter:this.settings.lang.parameter,langValue:this.settings.lang.value});a('#'+g+'_'+h+'_wrap').append(q),o||a('.'+g+'-'+h+'-item').last().find('div>input:first').focus(),a('.formBuilder-valueslist-btnDel').unbind(),a('.formBuilder-valueslist-btnDel').click(function(r){r.stopPropagation(),a(this).parent().parent().remove()})},setValidation:function setValidation(g){this.validation=g},setEditMode:function setEditMode(g){this.settings.edit=g},clearErrors:function clearErrors(){a('.'+this._prefix+'-form-field').removeClass(this.settings.formDangerClass),a('.'+this._prefix+'-error-text').hide()},resetForm:function resetForm(){this.clearErrors();this;for(var h in a('.'+this._prefix+'-form-field').not('.zoiaFormBuilder-no-reset').val(''),a('select.'+this._prefix+'-form-field').prop('selectedIndex',0),a('.formBuilder-valueslist-wrap').html(''),this.settings.items){var j=this.settings.items[h];j.default&&a('#'+this._prefix+'_'+h).val(j.default),'launcher'===j.type&&(a('#'+this._prefix+'_'+h+'_val').html(j.value),a('#'+this._prefix+'_'+h+'_val').attr('data',j.data)),'checkboxlist'===j.type&&a('.'+this._prefix+'-'+h+'-cbx').prop('checked',!1)}},serialize:function serialize(){var l=this,g={};for(var h in this.settings.items){var j=this.settings.items[h];-1!==this._formTypes.indexOf(j.type)&&function(){switch(j.type){case'launcher':g[h]={type:j.type,value:a('#'+l._prefix+'_'+h+'_val').html(),id:a('#'+l._prefix+'_'+h+'_val').attr('data')};break;case'checkboxlist':var o=a('.'+l._prefix+'-'+h+'-cbx:checked').map(function(){return a(this).attr('data')}).get();g[h]={type:j.type,value:o.join(',')};break;case'valueslist':var q=[];a('.'+l._prefix+'-'+h+'-item').each(function(){q.push({p:a(this).find('*>.formBuilder-valueslist-par').val()+'',v:a(this).find('*>.formBuilder-valueslist-val').val()+''})}),g[h]={type:j.type,value:q};break;default:g[h]={type:j.type,value:a('#'+l._prefix+'_'+h).val()};}}()}return g},deserialize:function deserialize(g){if(g&&'object'===('undefined'==typeof g?'undefined':_typeof(g)))for(var h in this.settings.items)switch(g[h]||(g[h]={id:'',value:''}),g[h].type){case'launcher':a('#'+this._prefix+'_'+h+'_val').html(g[h].value),a('#'+this._prefix+'_'+h+'_val').attr('data',g[h].id);break;case'checkboxlist':var j=g[h].value.split(',');for(var l in j)a('.editForm-groups-cbx[data="'+j[l]+'"]').prop('checked',!0);break;case'valueslist':var o=[];for(var q in g[h].value)o.push(g[h].value[q].p),o.push(g[h].value[q].v);for(a('#'+this._prefix+'_'+h+'_wrap').html('');0<o.length;){var r=o.shift(),t=o.shift();this._valueslistAddFunc(this._prefix,h,r,t,!0)}break;default:a('#'+this._prefix+'_'+h).val(g[h].value||'');}},loadData:function loadData(g){this.settings.events.onLoadStart&&this.settings.events.onLoadStart(),this.resetForm();var h=this;a.ajax({type:this.settings.load.method,url:this.settings.load.url,data:g,cache:!1}).done(function(j){j&&1===j.status?(jQuery.each(j.item,function(l,o){if(a('#'+h._prefix+'_'+l).val(o),h.settings.items[l]&&'checkboxlist'===h.settings.items[l].type&&o){var q=o.split(',');for(var r in q)a('.editForm-groups-cbx[data="'+q[r]+'"]').prop('checked',!0)}if(h.settings.items[l]&&'valueslist'===h.settings.items[l].type&&o){var t=[];for(var u in o)t.push(u),t.push(json[n].values[u]);for(var w in a('#'+h._prefix+'_'+l+'_wrap').html(''),json[n].values)h._valueslistAddFunc(h._prefix,l,t.shift(),t.shift())}}),h.settings.events.onLoadSuccess&&h.settings.events.onLoadSuccess(j)):h.settings.events.onLoadError&&h.settings.events.onLoadError(j)}).fail(function(j,l){h.settings.events.onLoadError&&h.settings.events.onLoadError(j,l)})},captchaRefresh:function captchaRefresh(){a('.'+this._prefix+'-captcha-img').show(),a('.'+this._prefix+'-captcha-img').attr('src',this.settings.captcha+'?'+new Date().getTime()),a('.'+this._prefix+'-captcha-field').val('')},_captchaInit:function _captchaInit(){this.captchaRefresh();var g=this;a('img.'+this._prefix+'-captcha-img').click(function(){g.captchaRefresh()})},_template:function _template(g,h){for(var j in h)g=g.replace(new RegExp('{'+j+'}','g'),h[j]);return g},validate:function validate(g){var q=this,h={},j={};for(var l in this.settings.items){var o=this.settings.items[l];if(-1!==this._formTypes.indexOf(o.type)){if('launcher'===o.type){j[l]=g?g[l]?g[l].id:void 0:a('#'+this._prefix+'_'+l+'_val').attr('data');continue}if('valueslist'===o.type){var _ret2=function(){if(g[l])return j[l]=g[l].value,'continue';var w=[];return a('.'+q._prefix+'-'+l+'-item').each(function(){w.push({p:a(this).find('*>.formBuilder-valueslist-par').val()+'',v:a(this).find('*>.formBuilder-valueslist-val').val()+''})}),j[l]=w,'continue'}();if('continue'===_ret2)continue}if('checkboxlist'===o.type){var r=a('.'+this._prefix+'-'+l+'-cbx:checked').map(function(){return a(this).attr('data')}).get();j[l]=g?g[l]?g[l].value:void 0:r.join(',');continue}var t=g?g[l]?g[l].value:void 0:a('#'+this._prefix+'_'+l).val();if(o.validation){if(!o.validation.mandatoryEdit&&!t&&this.settings.edit||!o.validation.mandatoryCreate&&!t&&!this.settings.edit)continue;if(o.validation.mandatoryCreate&&!t&&!this.settings.edit){h[l]=this.settings.lang.mandatoryMissing;continue}if(o.validation.mandatoryEdit&&!t&&this.settings.edit){h[l]=this.settings.lang.mandatoryMissing;continue}if(o.validation.process&&'function'==typeof o.validation.process&&(t=o.validation.process(t)),'passwordConfirm'===o.type){var u=a('#'+this._prefix+'_'+l+'Confirm').val();if(u!==t){h[l]=this.settings.lang.passwordsNotMatch;continue}}if(o.validation.length){if(o.validation.length.min&&t.length<o.validation.length.min){h[l]=this.settings.lang.tooShort;continue}if(o.validation.length.max&&t.length>o.validation.length.max){h[l]=this.settings.lang.tooLong;continue}}if(o.validation.regexp&&!t.match(o.validation.regexp)){h[l]=this.settings.lang.invalidFormat;continue}j[l]=t}}}return{data:j,errors:h}},errors:function errors(g){if(0<Object.keys(g).length){var h=!1;for(var j in g)a('#'+this._prefix+'_'+j).addClass(this.settings.formDangerClass),a('#'+this._prefix+'_'+j+'_error_text > span').html(g[j]),a('#'+this._prefix+'_'+j+'_error_text').show(),h||(a('#'+this._prefix+'_'+j).focus(),h=!0),'passwordConfirm'===this.settings.items[j].type&&a('#'+this._prefix+'_'+j+'Confirm').addClass(this.settings.formDangerClass);return!0}return!1},_submit:function _submit(){if(!this._saving){this.settings.events.onSaveSubmit&&this.settings.events.onSaveSubmit(),this.clearErrors();var g=this,h={},j={};if(this.settings.validation){var l=this.validate();if(h=l.data||{},j=l.errors||{},this.errors(j))return;if(this.settings.events.onSaveValidate&&(h=this.settings.events.onSaveValidate(h)||h,'__stop'===h))return}else if(this.settings.events.onSaveValidate&&(h=this.settings.events.onSaveValidate(h),'__stop'===h))return;g._saving=!0,a.ajax({type:this.settings.save.method,url:this.settings.save.url,data:h,cache:!1}).done(function(o){if(g._saving=!1,o&&1===o.status)g.settings.events.onSaveSuccess&&g.settings.events.onSaveSuccess(o);else{if(o.fields)for(var q in o.fields){var r=!1;a('#'+g._prefix+'_'+o.fields[q]).addClass(g.settings.formDangerClass),r||(a('#'+g._prefix+'_'+o.fields[q]).focus(),r=!0)}g.captchaRefresh(),g.settings.events.onSaveError&&g.settings.events.onSaveError(o)}}).fail(function(o,q){g._saving=!1,g.captchaRefresh(),g.settings.events.onSaveError&&g.settings.events.onSaveError(o,q)})}}}),a.fn[b]=function(g){var h;return this.each(function(){h=a.data(this,'plugin_'+b),h||(h=new f(this,g),a.data(this,'plugin_'+b,h))}),h}})(jQuery,window,document);